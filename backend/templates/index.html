// ... (omitted HTML/CSS for brevity)
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
    // ... (omitted state and map setup) ...

    // --- 4. Handle Button Click and Send Data to Backend ---
    document.getElementById('getDataBtn').addEventListener('click', async () => {
        // ... (omitted initial checks) ...

        const dataToSend = {
            latitude: selectedLat,
            longitude: selectedLng
        };

        // *** CRITICAL CHANGE: Updated to match the Flask endpoint ***
        const backendUrl = 'http://localhost:3000/predict';

        aqiResultDisplay.innerHTML = 'Fetching data...';
        aqiResultDisplay.style.display = 'block';

        try {
            const response = await fetch(backendUrl, {
                method: 'POST', // Correct method
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(dataToSend)
            });

            // This must be used because the Flask app now returns JSON
            const result = await response.json();

            if (response.ok) {
                // Success: Accesses the 'aqi_level' key from the JSON response
                aqiResultDisplay.style.borderColor = '#28a745';
                aqiResultDisplay.style.backgroundColor = '#e2ffed';
                aqiResultDisplay.innerHTML = `
                        ✅ **AQI Level Found!**<br>
                        Level: ${result.aqi_level}
                    `;
            } else {
                // Error response from the server (e.g., status 400 or 500 from Flask)
                aqiResultDisplay.style.borderColor = '#dc3545';
                aqiResultDisplay.style.backgroundColor = '#ffe2e6';
                // Assumes Flask returns {"error": "..."} on failure
                aqiResultDisplay.innerHTML = `
                        ❌ **Error:** Could not retrieve AQI.<br>
                        Details: ${result.error || 'Check server logs.'}
                    `;
            }
        } catch (error) {
            // Network error
            // ... (omitted error message) ...
        }
    });

</script>
</body>

</html>